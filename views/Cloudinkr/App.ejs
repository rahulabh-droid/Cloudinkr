<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CloudInkr Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/styles/Cloud.css" />
</head>

<body>

  <%- include('../Partials/Header-App') %>


    <div class="container">
      <span class="alert3">
        <h1>Welcome to CloudInkr Dashboard</h1>
      </span>

      <form id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data" class="mb-4">
        <div class="mb-4">
          <label for="file" class="form-label">Upload a new file:</label>
          <input type="file" name="file" id="file" class="form-control" required />
        </div>
        <button type="submit" id="uploadBtn" class="btn btn-primary">Upload</button>
      </form>

      <div id="loading" style="display:none; text-align:center; margin-top:10px;">
        <img src="/images/loading3.gif" alt="Loading..." width="300" height="150" />
      </div>

      <h3 class="alert2">ðŸ“‚ Your Uploaded Files</h3>

    </div>
    <% if (files && files.length> 0) { %>
      <div class="row">
        <% files.forEach(file=> {
          let ext = '';
          if (file.format) {
          ext = file.format.toLowerCase();
          } else if (file.path) {
          ext = file.path.split('.').pop().toLowerCase();
          }
          const isImage = ['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext);
          %>
          <div class="col-md-4 mb-4">
            <div class="card shadow-sm h-100">
              <% if (isImage) { %>
                <img src="<%= file.secure_url || file.path %>" class="card-img-top" alt="Uploaded Image"
                  style="max-height: 200px; object-fit: cover;">
                <% } else { %>
                  <div class="card-body d-flex align-items-center justify-content-center" style="height: 150px;">
                    <p class="text-muted text-center">ðŸ“„ <%= file.original_filename || file.public_id %>
                    </p>
                  </div>
                  <% } %>
                    <div class="card-body d-flex justify-content-between">
<a href="/download?public_id=<%= encodeURIComponent(file.public_id) %>&resource_type=<%= file.resource_type %>&format=<%= file.format %>" 
   class="btn btn-outline-secondary btn-sm ms-2">Download</a>

                    </div>
            </div>
          </div>
          <% }) %>
      </div>
      <% } else { %>
        <div class="alert">No files uploaded yet.</div>
        <% } %>
          </div>

          <%- include('../Partials/Footer-App') %>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            <script>
              const form = document.getElementById('uploadForm');
              const loading = document.getElementById('loading');
              const uploadBtn = document.getElementById('uploadBtn');

              form.addEventListener('submit', function (e) {
                loading.style.display = 'block';
                uploadBtn.disabled = true;
              });
            </script>
</body>

</html>